<div class="table-container-admin" style="margin-top: 50px">
    <table class="admin-table" id="adminTable" align="center">
        <thead>
            <tr>
                <th> Email </th>
                <th> Alias </th>
                <th> Last 10 Digits </th>
                <th> Bit Length </th>
                <th> Prime Number </th>
                <th> Factorized Count </th>
                <th> First Factorized Time </th>
            </tr>
        </thead>
        <tfoot>
        </tfoot>
        <tbody>
        </tbody>
    </table>
</div><br /><br />

<div style="text-align: center; padding-bottom: 100px">
    <button class="btn btn-primary" type="button" onclick="adminLink('/close?status=true&')">Close Submissions</button>
    <button class="btn btn-primary" type="button" onclick="adminLink('/close?status=false&')">Open Submissions</button>
    <button class="btn btn-primary" type="button" onclick="adminLink('/publish?status=true&')">Publish Submissions</button>
    <button class="btn btn-primary" type="button" onclick="adminLink('/publish?status=false&')">Un-publish Submissions</button>
    <button class="btn btn-primary" type="button" onclick="adminLink('/download-csv?')">Download student-data.csv</button>
    <button class="btn btn-primary" type="button" onclick="deleteSelection()">Delete Selection</button>
    <form action="fileupload" method="post" enctype="multipart/form-data">
        <input type="file" id="files" style="visibility:hidden" name="filetoupload">
        <label for="files" class="btn btn-primary">Upload students.txt file</label>
        <input type="submit" value="Submit" class="btn btn-primary">
        <h3>{{check}}</h3>
    </form>
</div>


<script>
    /*
        So we can either use $.get(admins) to check for mult subs and have the special case or everything can be handled
        like there are multiple submissions when in reality there is only one for everyone except admins

        Case 1: use $.get(admins)
            pros: Added check in case something else fails, only post first submission in data.json for students
            cons: extra server call

        Case 2: iterate over everyone's submissions as if there are multiple
            pros: One less server call
            cons: if submit-num fails and doesn't overwrite previous submissions, there could be multiple submissions per student
     */
    $(document).ready(function(){
        var adminTable = document.getElementById('adminTable').getElementsByTagName('tbody')[0];

        var numData = JSON.parse('{{course.JSON}}');

        var studentCount = 0;
        var adminCount = 0;
        for(var key in numData) {
            if (numData[key][0].type === 'student') {
                studentCount++;
                var row = adminTable.insertRow(0);
                row.insertCell(0).innerHTML = numData[key][0].email;
                row.insertCell(1).innerHTML = numData[key][0].alias;
                row.insertCell(2).innerHTML = numData[key][0].num_submit.slice(-10);
                row.insertCell(3).innerHTML = numData[key][0].num_length;
                row.insertCell(4).innerHTML = numData[key][0].num_prime;
                row.insertCell(5).innerHTML = numData[key][0].factor_count;
                row.insertCell(6).innerHTML = numData[key][0].first_factor_time;
                row.className = "header"
            } else {
                for (var sub in numData[key][0].nums) {
                    adminCount++;
                    var row = adminTable.insertRow(0);
                    row.insertCell(0).innerHTML = numData[key][0].email;
                    row.insertCell(1).innerHTML = numData[key][0].nums[sub].alias;
                    row.insertCell(2).innerHTML = numData[key][0].nums[sub].num_submit.slice(-10);
                    row.insertCell(3).innerHTML = numData[key][0].nums[sub].num_length;
                    row.insertCell(4).innerHTML = numData[key][0].nums[sub].num_prime;
                    row.insertCell(5).innerHTML = numData[key][0].nums[sub].factor_count;
                    row.insertCell(6).innerHTML = numData[key][0].nums[sub].first_factor_time;
                    row.className = "header"
                }
            }

        }

        var table = $('#adminTable').DataTable();
        $('#adminTable tbody').on( 'click', 'tr', function () {
            if ( $(this).hasClass('selected') ) {
                console.log("Entered")
                $(this).removeClass('selected');

                /*$("#tr1").find('td').removeClass('currRow').addClass('hideRow');
                $("#tr1").animate({
                    height: "0px",
                }, 1000)*/
            }
            else {
                console.log("Entered2")
                table.$('tr.selected').removeClass('selected');
                $(this).addClass('selected');

                /*var trindex=0;
                if ($(this).find("td:first").length > 0) { //check whether it is header or content row
                    //row index increment to assign new row id everytime
                    trindex++;
                    //create a row with td colspan 3 to show product description
                    var row= '><td class="currRow" colspan="7" >Not Factored Yet</td></tr>';

                    //adding animation to row
                    var newRow = $("<tr id=tr"+ trindex + row).animate({
                        height: "70px",
                    }, 500);
                    //adding row to existing table
                    $(this).after(newRow);
                }*/
            }
        });
    });
</script>
