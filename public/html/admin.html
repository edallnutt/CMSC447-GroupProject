<div class="table-container-admin" style="margin-top: 100px">
    <table class="admin-table" id="adminTable" align="center">
        <thead>
            <tr>
                <th> Email </th>
                <th> Alias </th>
                <th> Part of Number </th>
                <th> Number Length </th>
                <th> Factorized Count </th>
                <th> First Factorized Time </th>
            </tr>
        </thead>
        <tfoot>
        </tfoot>
        <tbody>
        </tbody>
    </table>
</div>

<div style="text-align: center">
    <button type="button" onclick="adminLink('/close?status=true&')">Close Submissions</button>
    <button type="button" onclick="adminLink('/close?status=false&')">Open Submissions</button>
    <button type="button" onclick="adminLink('/publish?status=true&')">Publish Submissions</button>
    <button type="button" onclick="adminLink('/publish?status=false&')">Un-publish Submissions</button>
    <button type="button" onclick="deleteSelection()">Delete Selection</button>
</div>


<script>

    /*
        So we can either use $.get(admins) to check for mult subs and have the special case or everything can be handled
        like there are multiple submissions when in reality there is only one for everyone except admins

        Case 1: use $.get(admins)
            pros: Added check in case something else fails, only post first submission in data.json for students
            cons: extra server call

        Case 2: iterate over everyone's submissions as if there are multiple
            pros: One less server call
            cons: if submit-num fails and doesn't overwrite previous submissions, there could be multiple submissions per student
     */
    $(document).ready(function(){
        var adminTable = document.getElementById('adminTable').getElementsByTagName('tbody')[0];

        var numData = JSON.parse('{{course.JSON}}');

        $.get('/get-admins', function(data) {
            var i = 0;
            for(var key in numData){

//                for(var sub in numData[key]) {
//                        var row = adminTable.insertRow(0);
//                        row.insertCell(0).innerHTML = key;
//                        row.insertCell(1).innerHTML = numData[key][sub].alias;
//                        row.insertCell(2).innerHTML = numData[key][sub].num_submit;
//                        row.insertCell(3).innerHTML = numData[key][sub].num_length;
//                        row.insertCell(4).innerHTML = numData[key][sub].factor_count;
//                        row.insertCell(5).innerHTML = numData[key][sub].first_factor_time;
//                        i++;
//                    }


                if(data.indexOf(key) != -1) {
                    var row = adminTable.insertRow(0);
                    row.insertCell(0).innerHTML = key;
                    row.insertCell(1).innerHTML = numData[key][0].alias;
                    row.insertCell(2).innerHTML = numData[key][0].num_submit;
                    row.insertCell(3).innerHTML = numData[key][0].num_length;
                    row.insertCell(4).innerHTML = numData[key][0].factor_count;
                    row.insertCell(5).innerHTML = numData[key][0].first_factor_time;
                    i++;
                } else {
                    for(var sub in numData[key]) {
                        var row = adminTable.insertRow(0);
                        row.insertCell(0).innerHTML = key;
                        row.insertCell(1).innerHTML = numData[key][sub].alias;
                        row.insertCell(2).innerHTML = numData[key][sub].num_submit;
                        row.insertCell(3).innerHTML = numData[key][sub].num_length;
                        row.insertCell(4).innerHTML = numData[key][sub].factor_count;
                        row.insertCell(5).innerHTML = numData[key][sub].first_factor_time;
                        i++;
                    }
                }


            }

            $('#adminTable').DataTable();
            $('#adminTable tbody').on( 'click', 'tr', function () {
                if ( $(this).hasClass('selected') ) {
                    $(this).removeClass('selected');
                }
                else {
                    table.$('tr.selected').removeClass('selected');
                    $(this).addClass('selected');
                }
            } );

        });

    });
</script>
