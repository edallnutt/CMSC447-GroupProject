<div class="sub-ans-table">
    <div id="btn-group">
        <button class="button button-blue" id="none" onclick="sort(0)">Sort by Alias</button>
        <button class="button button-blue" id="none" onclick="sort(1)">Sort by Factor Count</button>
        <button class="button button-blue" id="scientific" onclick="sort(2)">Sort by Bit Length</button>
    </div>
    <div id="chart_div"></div>
    <br/><br/>
    <div id="btn-group">
        <button class="button button-blue" id="none" onclick="sort(0)">Sort by Alias</button>
        <button class="button button-blue" id="none" onclick="sort(1)">Sort by Factor Count</button>
        <button class="button button-blue" id="scientific" onclick="sort(2)">Sort by Bit Length</button>
    </div>
    <script>
        google.charts.load('current', {'packages':['bar']});
        google.charts.setOnLoadCallback(drawChart);

        var email_num = '{{student_num}}';                              // Number associated with user
        var courseData = JSON.parse('{{course.JSON}}');                 // Project data
        var dataArray = [['Alias', 'Factor Count', 'Bit Length']];      // Array data for bar chart

        // Create array data for bar chart
        for(var i = 0; i < courseData.length; i++){
            if(courseData[i][0].type === "admin"){
                for(var sub in courseData[i][0].nums){
                    dataArray.push([courseData[i][0].nums[sub].alias, courseData[i][0].nums[sub].factor_count, courseData[i][0].nums[sub].num_length])
                }
            }
            else{
                dataArray.push([courseData[i][0].alias, courseData[i][0].factor_count, courseData[i][0].num_length])
            }
        }

        // Draw Initial Graph
        function drawChart() {

            /* Display bar chart */

            var data = google.visualization.arrayToDataTable(dataArray);

            var options = {
                chart: {
                    title: 'Number Results',
                    subtitle: 'RSA Factoring Challenge',
                },
                series: {
                    0: { axis: 'count' },
                    1: { axis: 'bits' }
                },
                axes: {
                    x: {
                        count: { label: 'Factor Count' },
                        bits: { side: 'top', label: 'Bit Length' }
                    }
                },
                bars: 'horizontal',             // Required for Material Bar Charts.
                hAxis: {format: 'decimal'},
                width: 1200,
                height: 2600,
                colors: ['#1b9e77', '#fe9834']
            };

            var chart = new google.charts.Bar(document.getElementById('chart_div'));

            chart.draw(data, google.charts.Bar.convertOptions(options));

        }

        // Sort and redraw graph
        function sort(type) {
            var data;

            // Insertion Sort Alias - params(dataArray)
            if(type === 0){
                for(var i = 2; i < dataArray.length; i++){
                    var key = dataArray[i];
                    var j = i - 1;

                    while(j > 0 && dataArray[j][type] > key[type]){
                        dataArray[j + 1] = dataArray[j];
                        j--;
                    }
                    dataArray[j + 1] = key;
                }
                console.log(dataArray);
            }
            // Radix Sort either Factor Count or Bit Length
            else{

                // Find largest Factor Count or Bit Length
                var largest =  parseInt(dataArray[1][type]);
                for(var i = 2; i < dataArray.length; i++){
                    if(parseInt(dataArray[i][type]) > largest){
                        largest = parseInt(dataArray[i][type]);
                    }
                }

                // Pad numbers to match #digits of largest int
                var largestStr = largest.toString();
                for(var i = 1; i < dataArray.length; i++){
                    var str = dataArray[i][type].toString();
                    while(str.length < largestStr.length){
                        str = "0" + str;
                    }
                    dataArray[i][type] = str;
                }

                var frequency = new Array(largest).fill(0);
                var sorted = new Array(dataArray.length);
                sorted[0] = ['Alias', 'Factor Count', 'Bit Length'];

                /* Radix Sort - params(dataArray, largestStr.length + 1) */
                for(var i = 1; i < largestStr.length + 1; i++){

                    /* Counting Sort params(dataArray) */

                    // Count occurences of each Factor Count or Bit Length
                    for(var j = 1; j < dataArray.length; j++){
                        if(i === 1){
                            frequency[dataArray[j][type].toString().slice(-1)]++;
                        }
                        else{
                            frequency[dataArray[j][type].toString().slice(-i, -i + 1)]++;
                        }
                    }

                    // Subsequently add occurence counts to the prev occurence count
                    for(var j = 1; j < frequency.length; j++){
                        frequency[j] = frequency[j - 1] + frequency[j];
                    }

                    // Stable sort original array using occurence count array into sorted array
                    for(var j = dataArray.length - 1; j > 0; j--){
                        if(i === 1){
                            sorted[frequency[dataArray[j][type].toString().slice(-1)]] = dataArray[j];
                            frequency[dataArray[j][type].toString().slice(-1)]--;
                        }
                        else{
                            sorted[frequency[dataArray[j][type].toString().slice(-i, -i + 1)]] = dataArray[j];
                            frequency[dataArray[j][type].toString().slice(-i, -i + 1)]--;
                        }
                    }

                    /* Counting Sort End */

                    dataArray = sorted.slice();     // Assign new data to original data
                    frequency.fill(0);              // Reset occurence count array
                }
            }

            /* Display bar chart */

            data = google.visualization.arrayToDataTable(dataArray);

            var options = {
                chart: {
                    title: 'Number Results',
                    subtitle: 'RSA Factoring Challenge',
                },
                series: {
                    0: { axis: 'count' },
                    1: { axis: 'bits' }
                },
                axes: {
                    x: {
                        count: { label: 'Factor Count' },
                        bits: { side: 'top', label: 'Bit Length' }
                    }
                },
                bars: 'horizontal', // Required for Material Bar Charts.
                hAxis: {format: 'decimal'},
                width: 1200,
                height: 2600,
                colors: ['#1b9e77', '#fe9834']
            };

            var chart = new google.charts.Bar(document.getElementById('chart_div'));

            chart.draw(data, google.charts.Bar.convertOptions(options));

        }
    </script>
</div>
